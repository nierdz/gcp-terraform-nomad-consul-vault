{
  "variables": {
    "account_file": "{{ env `GOOGLE_APPLICATION_CREDENTIALS` }}",
    "project_id": "{{ env `GOOGLE_PROJECT` }}",
    "image_name": "{{ env `IMAGE_NAME` }}"
  },
  "builders": [
    {
      "type": "googlecompute",
      "account_file": "{{ user `account_file` }}",
      "project_id": "{{ user `project_id` }}",
      "source_image": "debian-9-stretch-v20190514",
      "ssh_username": "admin",
      "image_name": "{{ user `image_name` }}",
      "zone": "europe-west1-b"
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "./",
      "destination": "~/"
    },
    {
      "type": "shell",
      "inline": [
        "sudo apt update",
        "sudo apt install -y make",
        "make install",
        "venv/bin/ansible-playbook playbook.yml"
      ]
    }
  ]
}
